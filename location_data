ruleset location_data {
    meta {
        name "Location Data"
        author "Riley Monson"
        logging off
        use module a169x701 alias CloudRain
        use module a41x186  alias SquareTag
        provides get_location_data
    }
    global {
        get_location_data = function(some_key) {
            (ent:location{some_key}.length() > 1) => ent:location{[some_key, "venue"]} | "No Value";
        }
    }
    rule display_location {
        select when web cloudAppSelected
        pre {
            my_html = <<
              <div id="content">
                Map:#{ent:location}<br>
                Key:#{ent:key}<br>
                Value:#{ent:value}
              </div>
            >>;
        }
        {
            SquareTag:inject_styling();
            CloudRain:createLoadPanel("Location", {}, my_html);
        }
    }
    rule add_location_item {
        select when pds new_location_data
        pre {
        //{ event:attr("key") : event:attr("value")}
            my_map = event:attrs().encode();
            key = event:attr("key");
        }
        send_directive(event:attr("key")) with body = {"location" : event:attr("value")};
        fired {
            set ent:location my_map;
            set ent:key key;
            set ent:value event:attr("value").encode();
        }
    }
}


